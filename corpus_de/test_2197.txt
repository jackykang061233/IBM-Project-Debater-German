Das Internet Control Message Protocol (ICMP) ist ein unterstützendes Protokoll in der Internet Protocol Suite. Es wird von Netzwerkgeräten, einschließlich Routern, verwendet, um Fehlermeldungen und Betriebsinformationen zu senden, die Erfolg oder Misserfolg angeben, wenn eine Kommunikation mit einer anderen IP-Adresse, beispielsweise ein Fehler angezeigt wird, wenn ein angeforderter Dienst nicht verfügbar ist oder dass ein Host oder Router nicht erreicht werden konnte. ICMP unterscheidet sich von Transportprotokollen wie TCP und UDP dadurch, dass es nicht typischerweise verwendet wird, um Daten zwischen Systemen auszutauschen, noch wird es regelmäßig von Endbenutzer-Netzwerkanwendungen eingesetzt (mit Ausnahme einiger diagnostischen Tools wie Ping und Traceroute). ICMP für IPv4 ist in RFC 792 definiert. Ein separates ICMPv6, definiert durch RFC 4443, wird mit IPv6 verwendet. Technische Details ICMP ist Teil der in RFC 792 definierten Internet-Protokoll-Suite. ICMP-Nachrichten werden typischerweise für Diagnose- oder Kontrollzwecke verwendet oder in Reaktion auf Fehler in IP-Betrieben erzeugt (wie in RFC 1122). ICMP-Fehler werden auf die Quell-IP-Adresse des Ursprungspakets gerichtet. Zum Beispiel, jedes Gerät (z.B. ein Zwischenrouter), das ein IP-Datengramm leitet, dekrementiert zunächst die Zeit zum Leben (TTL) Feld im IP-Header um eins. Wenn das resultierende TTL 0 ist, wird das Paket verworfen und eine ICMP-Zeit, die in der Transitnachricht überschritten wird, an die Datengramm-Quellenadresse gesendet. Viele häufig verwendete Netzwerkprogramme basieren auf ICMP-Nachrichten. Der Traceroute-Befehl kann durch die Übertragung von IP-Datengrammen mit speziell eingestellten IP-TTL-Headerfeldern implementiert werden und auf der Suche nach ICMP-Zeit überschritten in Transit- und Ziel-Unerreichbaren Nachrichten, die in Reaktion generiert werden. Das zugehörige Ping-Dienstprogramm wird mithilfe der ICMP-Echoanforderung und der Echoantwortnachrichten implementiert. ICMP nutzt die grundlegende Unterstützung von IP, als wäre es ein höheres Protokoll, aber ICMP ist eigentlich integraler Bestandteil von IP. Obwohl ICMP-Nachrichten innerhalb von Standard-IP-Paketen enthalten sind, werden ICMP-Nachrichten in der Regel als Sonderfall verarbeitet, der sich von der normalen IP-Verarbeitung unterscheidet. In vielen Fällen ist es erforderlich, den Inhalt der ICMP-Nachricht zu überprüfen und die entsprechende Fehlermeldung an die für die Übertragung des IP-Pakets verantwortliche Anwendung zu übermitteln, die die ICMP-Nachricht veranlasst hat. ICMP ist ein Netzwerk-Schicht-Protokoll. Den ICMP-Paketen ist keine TCP- oder UDP-Portnummer zugeordnet, da diese Zahlen der oben genannten Transportschicht zugeordnet sind. Datenstruktur Das ICMP-Paket wird in einem IPv4-Paket gekapselt. Das Paket besteht aus Header- und Datenabschnitten. Kopf Der ICMP-Header startet nach dem IPv4-Header und wird mit IP-Protokollnummer identifiziert ANHANG Alle ICMP-Pakete verfügen über einen 8-Byte-Header und einen variablen Datenbereich. Die ersten 4 Bytes des Headers haben festes Format, während die letzten 4 Bytes von dem Typ/Code dieses ICMP-Pakets abhängen. Typ ICMP-Typ, siehe Kontrollnachrichten. Code ICMP Subtyp, siehe Kontrollnachrichten. Prüfsumme Internet-Checkum (RFC 1071) zur Fehlerkontrolle, berechnet aus dem ICMP-Header und Daten mit dem für dieses Feld substituierten Wert 0. Rest des Headers Vier-Byte-Feld, die Inhalte variieren je nach ICMP-Typ und Code. Daten ICMP-Fehlermeldungen enthalten einen Datenabschnitt, der eine Kopie des gesamten IPv4-Headers umfasst, sowie mindestens die ersten acht Bytes von Daten aus dem IPv4-Paket, das die Fehlermeldung verursacht hat. Die maximale Länge von ICMP-Fehlermeldungen beträgt 576 Bytes. Diese Daten werden vom Host verwendet, um die Nachricht an den entsprechenden Prozess anzupassen. Wenn ein höheres Level-Protokoll Portnummern verwendet, werden sie in den ersten acht Bytes der Daten des ursprünglichen Datagramms angenommen. Die variable Größe des ICMP-Paketdatenabschnitts wurde ausgenutzt. Im "Ping of Death" werden große oder fragmentierte ICMP-Pakete für Denial-of-Service-Angriffe verwendet. ICMP-Daten können auch verwendet werden, um verdeckte Kanäle für die Kommunikation zu erstellen. Diese Kanäle sind als ICMP-Tunnel bekannt. Steuernachrichten Steuernachrichten werden durch den Wert im Typfeld identifiziert. Das Codefeld gibt zusätzliche Kontextinformationen für die Nachricht. Einige Kontrollnachrichten wurden seit der Einführung des Protokolls abgeschrieben. Source quench Source Quench fordert, dass der Absender die Rate der an einen Router oder Host gesendeten Nachrichten verringert. Diese Nachricht kann erzeugt werden, wenn ein Router oder Host nicht über einen ausreichenden Pufferraum zur Bearbeitung der Anfrage verfügt, oder wenn sich der Router oder Host-Puffer seiner Grenze nähert. Daten werden mit sehr hoher Geschwindigkeit von einem Host oder von mehreren Hosts gleichzeitig an einen bestimmten Router in einem Netzwerk gesendet. Obwohl ein Router Pufferfähigkeiten hat, ist die Pufferung innerhalb eines bestimmten Bereiches begrenzt.Der Router kann keine Daten mehr als die Kapazität des begrenzten Pufferraums löschen. Wenn also die Warteschlange gefüllt wird, werden eingehende Daten verworfen, bis die Warteschlange nicht mehr voll ist. Da jedoch in der Netzwerkschicht kein Bestätigungsmechanismus vorhanden ist, weiß der Client nicht, ob die Daten das Ziel erfolgreich erreicht haben. Daher sollten einige Sanierungsmaßnahmen von der Netzschicht ergriffen werden, um solche Situationen zu vermeiden. Diese Maßnahmen werden als Quelllöscher bezeichnet. In einem Quell-Quench-Mechanismus sieht der Router, dass die eingehende Datenrate viel schneller ist als die ausgehende Datenrate, und sendet eine ICMP-Nachricht an die Clients, indem er informiert, dass sie ihre Datentransfergeschwindigkeiten verlangsamen oder auf eine bestimmte Zeit warten sollten, bevor sie versuchen, mehr Daten zu senden. Wenn ein Client diese Nachricht empfängt, wird er automatisch die abgehende Datenrate verlangsamen oder auf eine ausreichende Zeit warten, die es dem Router ermöglicht, die Warteschlange zu leeren. So wirkt die Quelllösch-ICMP-Nachricht als Flusssteuerung in der Netzwerkschicht. Da die Forschung nahelegte, dass "ICMP Source Quench [was] ein unwirksames (und unfaires) Gegenmittel für die Stauung war", wurden die Router-Erstellung von Quell-Quench-Nachrichten 1995 von RFC 1812 abgeschrieben. Ferner wurde die Weiterleitung und jede Art von Reaktion auf (Flow Control Actions) Quell-Quench-Nachrichten von 2012 von RFC 6633 abgeschrieben. Wenn: Typ muss auf 4 Code gesetzt werden, muss auf 0 IP-Header gesetzt werden und zusätzliche Daten vom Absender verwendet werden, um die Antwort mit der zugehörigen Anfrage zu entsprechen Redirect Redirect Anfragen Datenpakete auf einer alternativen Route gesendet werden. ICMP Redirect ist ein Mechanismus für Router, um Routing-Informationen an Hosts zu übermitteln. Die Nachricht informiert einen Host, um seine Routing-Informationen zu aktualisieren (Pakete auf einer alternativen Route zu senden). Wenn ein Host versucht, Daten über einen Router (R1) zu senden und R1 sendet die Daten auf einem anderen Router (R2) und ein direkter Pfad vom Host zu R2 ist verfügbar (d.h. der Host und R2 sind auf dem gleichen Ethernet-Segment), dann wird R1 eine Umleitungsnachricht senden, um den Host zu informieren, dass die beste Route für das Ziel über R2 ist. Der Host sollte dann seine Routeninformationen ändern und Pakete für das Ziel direkt an R2 senden. Der Router sendet noch das ursprüngliche Datengramm an das Ziel. Wenn das Datagram jedoch Routing-Informationen enthält, wird diese Nachricht nicht gesendet, auch wenn eine bessere Route zur Verfügung steht. RFC 1122 erklärt, dass Umleitungen nur von Gateways gesendet werden sollten und nicht von Internet-Hosts gesendet werden sollten. Wo: Typ muss auf 5 gesetzt werden. Code gibt den Grund für die Umleitung an und kann einer der folgenden sein: IP-Adresse ist die 32-Bit-Adresse des Gateways, an das die Umleitung gesendet werden soll. IP-Header und zusätzliche Daten sind enthalten, damit der Host die Antwort mit der Anfrage, die die Umleitung Antwort verursachte, übereinstimmen kann. Zeit überschritten Zeit Übertroffen wird von einem Gateway generiert, um die Quelle eines verworfenen Datengramms aufgrund der Zeit zu leben Feld Null erreichen. Eine Zeitüberschreitung der Nachricht kann auch von einem Host gesendet werden, wenn es nicht gelingt, innerhalb seiner Frist ein fragmentiertes Datengramm wieder aufzubauen. Zeitüberschrittene Nachrichten werden vom Traceroute-Dienstprogramm verwendet, um Gateways auf dem Pfad zwischen zwei Hosts zu identifizieren. Wo: Typ muss auf 11 gesetzt werden Code gibt den Grund für die Zeit überschritten Nachricht, beinhalten die folgenden: IP-Header und erste 64 Bit der ursprünglichen Nutzlast werden vom Quell-Host verwendet, um die Zeit überschritten Nachricht an das verworfene Datengramm anzupassen. Für höherrangige Protokolle wie UDP und TCP umfasst die 64-Bit-Payload die Quell- und Zielports des verworfenen Pakets. Timestamp Timestamp wird zur Zeitsynchronisation verwendet. Der ursprüngliche Zeitstempel wird auf die Zeit gesetzt (in Millisekunden seit Mitternacht) der Absender zuletzt berührt das Paket. Die Empfangs- und Sendezeitstempel werden nicht verwendet. Wo: Typ muss auf 13 gesetzt werden Code muss auf 0 Identifier gesetzt werden und Sequenznummer kann vom Client verwendet werden, um die Zeitstempel Antwort mit der Zeitstempel-Anfrage zu entsprechen. Originate Timestamp ist die Anzahl der Millisekunden seit Mitternacht Universal Time (UT). Ist eine UT-Referenz nicht verfügbar, kann das bedeutendste Bit gesetzt werden, um einen nicht-Standard-Zeitwert anzuzeigen. Timestamp antwortet Timestamp Antworten auf eine Timestamp-Nachricht. Es besteht aus dem vom Absender des Timestamp gesendeten Original-Zeitstempel sowie einem Empfangs-Zeitstempel, der anzeigt, wann der Timestamp empfangen wurde und einem Sende-Zeitstempel, der anzeigt, wann die Timestamp-Antwort gesendet wurde. Wenn: Typ muss auf 14 Code gesetzt werden, muss auf 0 Identifier gesetzt werden und Sequenznummer kann vom Client verwendet werden, um die Antwort mit der Anforderung, die die Antwort verursacht.Originate timestamp ist die Zeit, die der Absender zuletzt die Nachricht berührte, bevor er sie sendete. Empfangen Sie Zeitstempel ist die Zeit, die der Echolot zuerst berührt es auf Empfang. Sendezeitstempel ist die Zeit, in der der Echolot die Nachricht beim Senden berührte. Alle Zeitstempel sind in Einheiten von Millisekunden seit Mitternacht UT. Ist die Zeit nicht in Millisekunden verfügbar oder kann nicht in Bezug auf Mitternacht UT bereitgestellt werden, so kann jederzeit in einen Zeitstempel eingefügt werden, sofern auch das hochauflösende Bit des Zeitstempels eingestellt ist, um diesen nicht-Standardwert anzuzeigen. Die Verwendung von Timestamp- und Timestamp-Nachrichten zur Synchronisierung der Uhren von Internet-Knoten wurde weitgehend durch das UDP-basierte Network Time Protocol und das Precision Time Protocol ersetzt. Adresse MaskenanfrageAdresse Maskenanfrage wird normalerweise von einem Host an einen Router gesendet, um eine entsprechende Subnetmaske zu erhalten. Empfänger sollten diese Nachricht mit einer Antwortnachricht der Adressmaske beantworten. Wo: Typ muss auf 17 gesetzt werden Code muss auf 0Adresse Maske gesetzt werden kann auf 0ICMP Adresse Maske Anfrage kann als Teil des Aufklärungs-Angriffs verwendet werden, um Informationen über das Zielnetz zu sammeln, daher ICMP Adresse Mask Reply wird standardmäßig auf Cisco IOS deaktiviert. Adressenmaske Antwort Adressenmaske Antwort wird verwendet, um eine Adressenmaske Anfrage Nachricht mit einer entsprechenden Subnetzmaske zu antworten. Wo: Der Typ muss auf 18 Code gesetzt werden, muss auf 0Adresse Maske gesetzt werden sollte auf die Subnetmaske Ziel unlösbares Reiseziel wird vom Host oder seinem inbound Gateway generiert, um den Client zu informieren, dass das Ziel aus irgendeinem Grund nicht erreichbar ist. Gründe für diese Nachricht können beinhalten: Die physische Verbindung zum Host existiert nicht (Abstand ist unendlich;) das angegebene Protokoll oder Port ist nicht aktiv; die Daten müssen fragmentiert werden, aber das Don't Fragment' Flag ist auf. Nicht erreichbare TCP-Ports reagieren insbesondere mit TCP RST und nicht mit einem Ziel, das nicht erreichbar ist, wie erwartet. Ziel ist nicht erreichbar für IP Multicast Übertragungen. Wenn: Feld Typ (bits 0-7) muss auf 3 Code Feld (bits 8-15) verwendet werden, um die Art des Fehlers anzugeben, und kann eines der folgenden sein: Das nächste MTU-Feld (bits 48-63) enthält die MTU des nächsten Hop-Netzwerks, wenn ein Code 4 Fehler auftritt. IP-Header und zusätzliche Daten sind enthalten, damit der Client die Antwort mit der Anfrage, die das Ziel verursachte, übereinstimmen kann. Siehe auch Referenzen RFC 792, Internet Control Message Protocol RFC 950, Internet Standard Subnetting Procedure RFC 1016, Irgendwas ein Host könnte mit Source Quench tun:The Source Quench Introducing Delay (SQuID) RFC 1122, Anforderungen für Internet Hosts – Kommunikationsebenen RFC 1716, Gegen Anforderungen an IP Routers RFC 1812, Anforderungen an IP Version 4 Router RFC 4884 erweiterte Links